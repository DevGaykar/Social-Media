{%load static%}
{% if conversation %}
    <header class="conversation-header">
        <div class="conversation-info">
            {% if conversation.type == 'world' %}
                <div class="profile-photo world-header" style="cursor: pointer;">
                    <img src="{% static '/images/world_chat.png' %}">
                </div>
                <div class="handle world-header" style="cursor: pointer;">
                    <h4>World Chat</h4>
                    <p class="text-muted">Global conversation</p>
                </div>
            {% elif conversation.type == 'group' %}
                <div class="profile-photo group-header" style="cursor: pointer;">
                    {% if conversation.group_image %}
                        <img src="{{ conversation.group_image.url }}">
                    {% else %}
                        <img src="{% static '/images/group.png' %}">
                    {% endif %}
                </div>
                <div class="handle group-header" style="cursor: pointer;">
                    <h4>{{ conversation.group_name }}</h4>
                    <p class="text-muted">Group conversation</p>
                </div>
            {% else %}
                {% for participant in conversation.participants.all %}
                    {% if participant != request.user %}
                        <a href="{% url 'userprofile' participant.profile.user %}">
                            <div class="profile-photo">
                                <img src="{{ participant.profile.avatar }}">
                            </div>
                            <div class="handle">
                                <h4>{{ participant.profile.name }}</h4>
                                <p class="text-muted">@{{ participant.username }}</p>
                            </div>
                        </a>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
    </header>
    <section class="message-list">
        {% for message in conversation.messages.all reversed %}
            <div class="message {% if message.sender == request.user %}sent{% else %}received{% endif %}">
                {% if conversation.type != 'one_to_one' %}
                    <div class="message-sender">
                        <img src="{{ message.sender.profile.avatar }}" class="profile-photo">
                        <span class="username">{{ message.sender.username }}</span>
                    </div>
                {% endif %}
                <pre>{{ message.body_decrypted }}</pre>
                <div class="message-time">{{ message.created|time:"H:i" }}</div>
            </div>
        {% endfor %}
    </section>
    <div class="message-input-container">
        <form method="POST" action="{% url 'inbox:send_message' conversation.id %}" id="message-form">
            {% csrf_token %}
            <textarea class="message-input" type="text" name="body" placeholder="Type a message..."></textarea>
            <button class="send-button" type="submit">Send</button>
        </form>
    </div>
{% else %}
    <div class="no-conversation-selected">
        <p>Select a conversation to start messaging</p>
    </div>
{% endif %}